package com.example.jdbcdemo.service;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import com.example.jdbcdemo.domain.Console;

public class ConsoleManager {

	private Connection connection;
	
	private String url = "jdbc:hsqldb:hsql://localhost/workdb";
	
	private String createTableConsole = "CREATE TABLE Console(id_console int GENERATED BY DEFAULT AS IDENTITY, name varchar(20), brand varchar(20), price decimal(6,2))";
	
	private PreparedStatement addConsole;
	private PreparedStatement deleteAllConsoles;
	private PreparedStatement getAllConsoles;
	
	private Statement statement;
	
	public ConsoleManager(){
		try{
			connection = DriverManager.getConnection(url);
			statement = connection.createStatement();
			
			ResultSet resultSet = connection.getMetaData().getTables(null, null, null, null);
			boolean tableExists = false;
			
			while(resultSet.next()){
				if("Console".equalsIgnoreCase(resultSet.getString("TABLE_NAME"))){
					tableExists = true;
					break;
				}
			}
			
			if(!tableExists){
				statement.executeUpdate(createTableConsole);
			}
			
			addConsole = connection.prepareStatement("INSERT INTO Console (name, brand, price) VALUES (?, ?)");
			deleteAllConsoles = connection.prepareStatement("DELETE FROM Console");
			getAllConsoles = connection.prepareStatement("SELECT * FROM Console");
		}catch(SQLException exception){
			exception.printStackTrace();
		}
	}
	
	Connection getConnection(){
		return connection;
	}
	
	void clearConsoles(){
		try{
			deleteAllConsoles.executeUpdate();
			
		}catch(SQLException exception){
			exception.printStackTrace();
		}
	}
	
	
	
}
